<!-- 
// Written by David Habib, copyright (c) 2009-2013 DJH Consulting, djhconsulting.com 
// This program is released under the GNU Affero General Public License, Version 3. http://www.gnu.org/licenses/
 -->

<apex:page controller="AUC_CTRL_AuctionNewTicketWizard"  title="New Auction Ticket Wizard" tabStyle="Auction_Tickets__tab" >
 
 	<script>
 	
		// function to populate Table Name/Number fields when the first one is filled in.
		function OnChangeTxtTableNameNumber(txt) {
			var rg = document.getElementsByTagName('input');
			var i = 0; 
			for (i = 0; i < rg.length; i++) {
				if (rg[i].id.indexOf('txtTableNameNumber') > -1) {
					if (rg[i].value == '') {
						rg[i].value = txt.value;
					}
				}
			}
 		}
 	</script>
 	
<style>
      
    .Error { 
    	color: red; 
    	font-weight: strong;
    }

	.apexp .editPage .bPageBlock .detailList .list tr td {
		padding: 1px 5px 1px 5px; 
		border-bottom: 1px solid #D4DADC;
	}
	
		.cssTabHelpLink {
			cursor: pointer;
			border-style: solid;
			border-radius: 4px;
			border-width: 1px;
			border-color: #DEEFF5;
			width: 110px;
			height: 20px; 
			color: black;
			vertical-align: middle;
			text-align: center;
			background-color: #FCFFFE;
			margin-top: 10px;
			margin-left: 10px;
			margin-bottom: 10px;
			padding-top: 4px;	
		}
		
		.cssTabHelpLink .helpLink {
			text-decoration: none;
			color: black;
			font-size: 105%;
			vertical-align: bottom;
		}

		.hideHelpLink {
			cursor: pointer;
			color: black;
		}
		
		.hideHelpLink .helpLink {
			color: grey;
			text-decoration: none;
		}
		
		.cssHelpText {
			background-color: mintcream;
			border-style: solid;
			border-width: 1px;
			border-color: lightBlue;
			border-radius: 10px;
			padding-top: 5px;	
			padding-bottom: 10px;
			padding-left: 10px;
			padding-right: 10px;	
			margin-top: 10px;
			margin-bottom: 10px;
			margin-right: 10px;
			margin-left: 10px;
		}
		
</style>
 
   	<apex:sectionHeader title="Auction Tickets" />      
    <apex:form > 	    
        <apex:pageBlock title="{!IF(opp.Id!=null,'Edit','New') + ' Auction Ticket'}" mode="edit" id="pbMain" >
            <apex:pageBlockButtons >
                <apex:commandButton action="{!Save}" value="Save"/>
                <apex:commandButton action="{!SaveAndClose}" value="Save & Close"/>
                <apex:commandButton action="{!Cancel}" value="{!IF(ISNULL(strSaveResults), 'Cancel', 'Close')}" immediate="true"/>
            </apex:pageBlockButtons>      
            <apex:pageMessage summary="{!strSaveResults}" severity="info" strength="2" rendered="{!strSaveResults!=null}" />  
            <apex:messages styleClass="Error" />  
            
 			<div class="cssTabHelpLink" id="linkHelp">
	  			<a class="helpLink" onclick="document.getElementById('linkHelp').style.display='none'; document.getElementById('divHelp').style.display='block';">
					<img src="/img/arrowRight.gif" />Show Help&nbsp;<img src="/s.gif" alt="" class="helpIcon" title=""/>
				</a>
			</div>
	   		<div id="divHelp" class="cssHelpText" style="display:none" >
	       		<div class="hideHelpLink">	       			
					<a class="helpLink" onclick="document.getElementById('divHelp').style.display='none';document.getElementById('linkHelp').style.display='block';">
						<img src="/img/arrowDown.gif" />Hide
					</a>
				</div>
				<p style="padding-left:30px">Fill in the fields for the Ticket purchase, followed by the Attendees paid for by this ticket.</p>
				<ul>
				<li>For ticket purchases by an individual, fill in the <b>Contact</b> field.&nbsp;&nbsp;For ticket purchases by an {!$ObjectType.Account.Label}, fill in the <b>{!$ObjectType.Account.Label}</b> field.</li>
				<li>The <b>Per Ticket Non-Deductible Amount</b> field is pre-filled with the amount specified in the Auction.  You can change it if needed, if you have different ticket levels.</li>
				<li>When you change the <b>Number of Tickets</b> field the page will refresh the Attendees grid.</li>
				<li>You can leave <b>Bid Number</b> empty for now, and use the <b>Assign Bid Number</b> button on the Tickets tab.</li>
				<li>You can add additional Ticket fields to the page using the Opportunity Field Set <b>AuctionNewTicketWizardFS</b>.</li>
				<li>You can add additional fields to the Attendees grid using the Campaign Member Field Set <b>AuctionNewTicketWizardFS</b>.</li>
				</ul>
	  		</div>
            
                        
            <apex:pageBlockSection title="Ticketing Information" columns="2">
                <apex:inputField value="{!opp.Name}" id="txtName" required="true" rendered="{!opp.Id != null}" />
                <apex:inputField value="{!contactRole.ContactId}" required="false" />                	       			
            
            	<!-- additional Opportunity fields use a fieldset -->
				<apex:repeat value="{!$ObjectType.Opportunity.FieldSets.AuctionNewTicketWizardFS}" var="f" >
   					<apex:inputField value="{!opp[f]}" required="{!IF(OR(f.DBRequired, f.Required), 'true', 'false')}" />
	  			</apex:repeat>                    	
                
                <!-- special case Number of Tickets, so we can update the attendees panel. -->
                <apex:inputField value="{!opp.Number_of_Tickets__c}" required="true" >
    	        	<apex:actionSupport immediate="false" event="onchange" action="{!OnChange_NumberOfTickets}" 
    	        		rerender="pbsAttendees, pbMain" focus="txtDescription" status="statusLoading" />
        			<apex:actionStatus startText="Loading..." stopText="" id="statusLoading" startStyle="color:green; font-style:italic" />
                </apex:inputField>

                <!-- special case FMV Override. -->
                <apex:pageBlockSectionItem >
                	<apex:outputLabel value="Per Ticket Non-Deductible Amount" />
                	<apex:inputText value="{!decTicketFMV}" required="true" id="PerTicketNon-DeductibleAmount" />
				</apex:pageBlockSectionItem>
				
            </apex:pageBlockSection>

            <apex:pageBlockSection title="Add Auction Attendees" columns="1" id="pbsAttendees" rendered="{!false || opp.Number_of_Tickets__c > 0}" >
            	<p style="font-weight:bold">Please list each individual that is attending with the purchase of these tickets.</p>
            	<br/>
        
				<apex:pageBlockTable value="{!listCmpMbrAttendees}" var="cmpmbr" >
					<apex:column style="text-align:center;" width="20px">		 				
						<apex:facet name="header"><div style="text-align:center;">Action</div></apex:facet>
		                <apex:commandLink action="{!DeleteCM}" value="Del" onclick="if (confirm('Are you sure?')==false) { return false;}" rendered="{!cmpmbr.id != null}" >
					    	<apex:param assignTo="{!idDeleteCM}" name="idDeleteCM" value="{!cmpmbr.id}" /> 
		                </apex:commandLink>
					</apex:column>	
					
	            	<!-- CM fields use a fieldset -->
					<apex:repeat value="{!$ObjectType.CampaignMember.FieldSets.AuctionNewTicketWizardFS}" var="f" >	
						<apex:column rendered="{!$ObjectType.CampaignMember.Fields.Status.Label != f.Label && 
								$ObjectType.CampaignMember.Fields.Table_Name_Number__c.Label != f.Label}"
								width="80px" style="text-align:center;" >
							<apex:facet name="header"><div style="text-align:center;">{!f.Label}</div></apex:facet>
	   						<apex:inputField value="{!cmpmbr[f]}" required="false"  style="width:80px" />
						</apex:column>					
						<!--  special case Status to use custom setting of values in picklist -->
						<apex:column rendered="{!$ObjectType.CampaignMember.Fields.Status.Label == f.Label}" 
							width="80px" style="text-align:center;" >
							<apex:facet name="header"><div style="text-align:center;">{!f.Label}</div></apex:facet>
						   	<apex:selectList value="{!cmpmbr.Status}" size="1" required="false"  >
						   		<apex:selectOptions value="{!listSOStatuses}" />
						   	</apex:selectList>
						</apex:column>											
						<!--  special case Table Name/Number to do auto copying of name/number to empty fields -->						
						<apex:column rendered="{!$ObjectType.CampaignMember.Fields.Table_Name_Number__c.Label == f.Label}" 
							width="80px" style="text-align:center;" >					
							<apex:facet name="header"><div style="text-align:center;">{!f.Label}</div></apex:facet>
							<apex:inputField id="txtTableNameNumber" value="{!cmpmbr.Table_Name_Number__c}" required="false" 
								onchange="OnChangeTxtTableNameNumber(this);"  style="width:80px" />
						</apex:column>										
		  			</apex:repeat>        	            	 
				</apex:pageBlockTable>	        
            </apex:pageBlockSection>        
        </apex:pageBlock>                
    </apex:form>
</apex:page>