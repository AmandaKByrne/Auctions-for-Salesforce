<!-- 
// Written by David Habib, copyright (c) 2009-2013 DJH Consulting, djhconsulting.com 
// This program is released under the GNU Affero General Public License, Version 3. http://www.gnu.org/licenses/
-->

<apex:page controller="AUC_CTRL_AuctionAutoBidNumbers" title="Auction Bid Numbers"  >

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
	<script type="text/javascript">
	    var j$ = jQuery.noConflict();
	</script>
	
	<style>
	    .Error { 
	    	color: red; 
	    	font-weight: strong;
	    }
	    
		.clsLoading {
			z-index: 99;
			position: fixed;
			top: 30%;
			left: 30%;
			background: lightyellow;
			width: 400px;
			height: 40px;		
		}   	    	    
    </style>
	
	<apex:sectionHeader title="Auction Bid Numbers" />  
	<apex:form >
		<apex:pageBlock title="Assign Auction Bid Numbers" mode="edit" id="pbMain" >
            <apex:pageBlockButtons >
                <apex:commandButton action="{!AutoBidNumbersSet}" value="Assign" rerender="pbMain" status="statusLoading" />
                <apex:commandButton action="{!Cancel}" value="{!IF(ISNULL(strAutoBidNumberResult), 'Cancel', 'Close')}" immediate="true"/>
            </apex:pageBlockButtons>      
            <apex:pageMessage summary="{!strAutoBidNumberResult}" severity="info" strength="2" rendered="{!strAutoBidNumberResult!=null}" />  
            <apex:messages styleClass="Error" />
			<apex:pageBlockSection columns="1" >
			
				<apex:outputLabel value="<p><i>It is recommended that you only assign a bid number to one member of a household.  You can set
					Auction Custom Settings to specify how your organization tracks households.  Please see the Auctions for Salesforce documentation.</i></p><br/>" 
					rendered="{!NOT(fHasHouseholds)}" escape="false" />
			
				<apex:pageBlockSectionItem rendered="{!fHasHouseholds}" >
					<apex:outputLabel value="Assign one bid number per household"  /> 
					<apex:inputCheckbox value="{!fOneBidNumberPerHousehold}" >
	    	        	<apex:actionSupport immediate="false" event="onchange" action="{!RecalcBidNumbers}" rerender="pbMain" status="statusLoading" />
					</apex:inputCheckbox>
				</apex:pageBlockSectionItem>							
			
				<apex:pageBlockSectionItem >
					<apex:outputLabel value="Starting Bid Number"  /> 
					<apex:inputText value="{!iStartingBidNumber}" >
	    	        	<apex:actionSupport immediate="false" event="onchange" action="{!RecalcBidNumbers}" rerender="pbMain" status="statusLoading" />
					</apex:inputText>
				</apex:pageBlockSectionItem>							

				<apex:pageBlockSectionItem />  
       			<apex:actionStatus id="statusLoading" onstart="j$('.loading').show();" onstop="j$('.loading').hide();" />       			
				<div class="loading clsLoading" id="divLoading" style="display:none" >
				  <p style="vertical-align: middle;" >
					<img src="/img/loading.gif" alt="Processing..." width="16" height="16" title="Processing..." style="vertical-align: middle;"/>
					<span class="loadingText" style="vertical-align: middle;" >Processing...</span>
				  </p>
				</div>        				            					            
       							
		        <apex:pageBlockTable value="{!listCMBidNumbers}" var="cmbn" id="pbtAttendees" > 
			        <apex:column headerValue="Attendee" width="200px" >
			        	<apex:outputLink value="/{!cmbn.cm.contactId}" >{!cmbn.cm.contact.LastName + ', ' + cmbn.cm.contact.FirstName}</apex:outputLink>
		            </apex:column>  	               
		            <apex:column value="{!cmbn.strHousehold}" headerValue="Household" rendered="{!fHasHouseholds}" width="200px" />
		            <apex:column value="{!cmbn.cm.Bid_Number__c}" width="100px" headerValue="Current Bid Number" /> 
		            <apex:column headerValue="New Bid Number" width="100px" >
		            	<apex:inputText value="{!cmbn.iNewBidNumber}" />
		            </apex:column> 
		            <apex:column width="1000px" /> <!-- to take up remaining width -->
		        </apex:pageBlockTable> 
	        </apex:pageBlockSection>
        </apex:pageBlock>              
	</apex:form>              

</apex:page>